<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Êïô‰ºöÁÇπÂêçÁªüËÆ°</title>
    
    <!-- PWA ÈÖçÁΩÆ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Êïô‰ºöÁÇπÂêç">
    <meta name="theme-color" content="#4CAF50">
    
    <!-- Â∫îÁî®ÂõæÊ†á -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' rx='36' fill='%234CAF50'/%3E%3Crect x='82' y='30' width='16' height='70' fill='white'/%3E%3Crect x='50' y='60' width='80' height='16' fill='white'/%3E%3Crect x='30' y='90' width='120' height='50' rx='6' fill='%238B4513'/%3E%3Crect x='36' y='96' width='108' height='38' rx='4' fill='%23D2691E'/%3E%3Cline x1='45' y1='106' x2='135' y2='106' stroke='%238B4513' stroke-width='3'/%3E%3Cline x1='45' y1='116' x2='115' y2='116' stroke='%238B4513' stroke-width='3'/%3E%3Cline x1='45' y1='126' x2='125' y2='126' stroke='%238B4513' stroke-width='3'/%3E%3C/svg%3E">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%234CAF50'/%3E%3Crect x='14' y='5' width='4' height='14' fill='white'/%3E%3Crect x='8' y='12' width='16' height='4' fill='white'/%3E%3Crect x='6' y='18' width='20' height='10' rx='1' fill='%238B4513'/%3E%3Crect x='7' y='19' width='18' height='8' rx='1' fill='%23D2691E'/%3E%3Cline x1='9' y1='21' x2='23' y2='21' stroke='%238B4513' stroke-width='1'/%3E%3Cline x1='9' y1='23' x2='19' y2='23' stroke='%238B4513' stroke-width='1'/%3E%3Cline x1='9' y1='25' x2='21' y2='25' stroke='%238B4513' stroke-width='1'/%3E%3C/svg%3E">
    
    <!-- ÂêØÂä®ÁîªÈù¢ -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- ManifestÊñá‰ª∂ÈìæÊé• -->
    <link rel="manifest" href="data:application/json,%7B%22name%22%3A%22%E6%95%99%E4%BC%9A%E7%82%B9%E5%90%8D%E7%BB%9F%E8%AE%A1%22%2C%22short_name%22%3A%22%E6%95%99%E4%BC%9A%E7%82%B9%E5%90%8D%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23ffffff%22%2C%22theme_color%22%3A%22%234CAF50%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%2C%253Csvg%2520xmlns%3D%27http%3A//www.w3.org/2000/svg%27%2520viewBox%3D%270%25200%2520512%2520512%27%253E%253Crect%2520width%3D%27512%27%2520height%3D%27512%27%2520rx%3D%27102%27%2520fill%3D%27%25234CAF50%27/%253E%253Cpath%2520d%3D%27M256%2520114c-47%25200-85%252038-85%252085%25200%252064%252085%2520199%252085%2520199s85-135%252085-199c0-47-38-85-85-85zm0%2520114c-16%25200-28-12-28-28s12-28%252028-28%252028%252012%252028%252028-12%252028-28%252028z%27%2520fill%3D%27white%27/%253E%253C/svg%253E%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%5D%7D">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .church-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            gap: 15px;
        }

        .logo-image {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 12px;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .logo-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .church-info {
            text-align: left;
        }

        .church-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 2px;
            color: white;
        }

        .church-name-en {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: normal;
        }

        .header h1 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            margin-top: 10px;
        }

        .header .date {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .content {
            padding: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .meeting-selector {
            margin-bottom: 20px;
        }

        .meeting-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .meeting-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .meeting-btn.active {
            border-color: #4CAF50;
            background: #f8fff8;
            color: #4CAF50;
        }

        .category-section {
            margin-bottom: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .member-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            margin-bottom: 8px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .member-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .member-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .member-name {
            flex: 1;
            font-size: 1rem;
        }

        .member-controls {
            display: flex;
            gap: 8px;
        }

        .edit-btn, .delete-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .edit-btn {
            background: #2196F3;
            color: white;
        }

        .delete-btn {
            background: #f44336;
            color: white;
        }

        .add-member {
            margin-top: 15px;
        }

        .add-member input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .add-member input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .add-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s ease;
        }

        .add-btn:hover {
            background: #45a049;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .history-date {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .history-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }

        .floating-save {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }

        .floating-save:hover {
            transform: scale(1.1);
        }

        .success-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            display: none;
            z-index: 1000;
        }

        /* PWA ÂêØÂä®ÁîªÈù¢Ê†∑Âºè */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .splash-logo {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .splash-text {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .splash-subtitle {
            font-size: 1rem;
            opacity: 0.8;
        }

        /* ÂÆâË£ÖÊèêÁ§∫ */
        .install-prompt {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #333;
            color: white;
            padding: 15px;
            text-align: center;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .install-prompt.show {
            transform: translateY(0);
        }

        .install-prompt button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            margin: 0 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- ÂêØÂä®ÁîªÈù¢ -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">
            <svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
                <!-- ÂçÅÂ≠óÊû∂ -->
                <rect x="36" y="15" width="8" height="35" fill="#4CAF50"/>
                <rect x="25" y="30" width="30" height="8" fill="#4CAF50"/>
                <!-- Âú£Áªè -->
                <rect x="15" y="45" width="50" height="25" rx="3" fill="#8B4513"/>
                <rect x="18" y="48" width="44" height="19" rx="2" fill="#D2691E"/>
                <line x1="22" y1="53" x2="58" y2="53" stroke="#8B4513" stroke-width="2"/>
                <line x1="22" y1="58" x2="50" y2="58" stroke="#8B4513" stroke-width="2"/>
                <line x1="22" y1="63" x2="54" y2="63" stroke="#8B4513" stroke-width="2"/>
            </svg>
        </div>
        <div class="splash-text">Âú£ÁªèÁõ¥ÈÅìÊïô‰ºö</div>
        <div class="splash-subtitle">ËÅö‰ºöÁÇπÂêçÁªüËÆ°Á≥ªÁªü</div>
    </div>

    <!-- ÂÆâË£ÖÊèêÁ§∫ -->
    <div class="install-prompt" id="installPrompt">
        <div>Â∞ÜÊ≠§Â∫îÁî®Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï‰ª•Ëé∑ÂæóÊõ¥Â•Ω‰ΩìÈ™å</div>
        <button onclick="showInstallInstructions()">‰∫ÜËß£Â¶Ç‰ΩïÂÆâË£Ö</button>
        <button onclick="hideInstallPrompt()">ÊöÇ‰∏ç</button>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <div class="church-logo">
                <div class="logo-image">
                    <svg width="44" height="44" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                        <!-- ÂçÅÂ≠óÊû∂ -->
                        <rect x="20" y="8" width="4" height="20" fill="#4CAF50"/>
                        <rect x="14" y="16" width="16" height="4" fill="#4CAF50"/>
                        <!-- Âú£Áªè -->
                        <rect x="10" y="24" width="24" height="16" rx="2" fill="#8B4513"/>
                        <rect x="12" y="26" width="20" height="12" rx="1" fill="#D2691E"/>
                        <line x1="15" y1="29" x2="29" y2="29" stroke="#8B4513" stroke-width="1"/>
                        <line x1="15" y1="32" x2="25" y2="32" stroke="#8B4513" stroke-width="1"/>
                        <line x1="15" y1="35" x2="27" y2="35" stroke="#8B4513" stroke-width="1"/>
                    </svg>
                </div>
                <div class="church-info">
                    <div class="church-name">Âú£ÁªèÁõ¥ÈÅìÊïô‰ºö</div>
                    <div class="church-name-en">LOGOS BIBLE CHURCH</div>
                </div>
            </div>
            <h1>ËÅö‰ºöÁÇπÂêçÁªüËÆ°</h1>
            <div class="date" id="currentDate"></div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('attendance')">ÁÇπÂêç</button>
            <button class="nav-tab" onclick="showSection('stats')">ÁªüËÆ°</button>
            <button class="nav-tab" onclick="showSection('manage')">ÁÆ°ÁêÜ</button>
        </div>

        <div class="content">
            <!-- ÁÇπÂêçÁïåÈù¢ -->
            <div id="attendance" class="section active">
                <div class="meeting-selector">
                    <div class="meeting-buttons">
                        <button class="meeting-btn active" data-meeting="friday">Âë®‰∫îËÅö‰ºö</button>
                        <button class="meeting-btn" data-meeting="sunday">Âë®Êó•ËÅö‰ºö</button>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-title">
                        Êàê‰∫∫ <span id="adultCount">0/0</span>
                    </div>
                    <div id="adultList"></div>
                </div>

                <div class="category-section">
                    <div class="category-title">
                        ÂÑøÁ´• <span id="childCount">0/0</span>
                    </div>
                    <div id="childList"></div>
                </div>
            </div>

            <!-- ÁªüËÆ°ÁïåÈù¢ -->
            <div id="stats" class="section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="todayTotal">0</div>
                        <div class="stat-label">‰ªäÊó•ÊÄªÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayAdults">0</div>
                        <div class="stat-label">Êàê‰∫∫</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayChildren">0</div>
                        <div class="stat-label">ÂÑøÁ´•</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="attendanceRate">0%</div>
                        <div class="stat-label">Âá∫Â∏≠Áéá</div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-title">Âá∫Â∏≠ÂéÜÂè≤</div>
                    <div id="historyList"></div>
                </div>
            </div>

            <!-- ÁÆ°ÁêÜÁïåÈù¢ -->
            <div id="manage" class="section">
                <div class="category-section">
                    <div class="category-title">Êàê‰∫∫ÂêçÂçï</div>
                    <div id="manageAdultList"></div>
                    <div class="add-member">
                        <input type="text" id="newAdultName" placeholder="ËæìÂÖ•Êàê‰∫∫ÂßìÂêç" />
                        <button class="add-btn" onclick="addMember('adult')">Ê∑ªÂä†Êàê‰∫∫</button>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-title">ÂÑøÁ´•ÂêçÂçï</div>
                    <div id="manageChildList"></div>
                    <div class="add-member">
                        <input type="text" id="newChildName" placeholder="ËæìÂÖ•ÂÑøÁ´•ÂßìÂêç" />
                        <button class="add-btn" onclick="addMember('child')">Ê∑ªÂä†ÂÑøÁ´•</button>
                    </div>
                </div>
            </div>
        </div>

        <button class="floating-save" onclick="saveAttendance()" title="‰øùÂ≠òÂá∫Â∏≠ËÆ∞ÂΩï">üíæ</button>
    </div>

    <div class="success-message" id="successMessage">‰øùÂ≠òÊàêÂäüÔºÅ</div>

    <script>
        // Êï∞ÊçÆÂ≠òÂÇ®
        let members = {
            adults: ['Âº†‰∏â', 'ÊùéÂõõ', 'Áéã‰∫î', 'ËµµÂÖ≠'],
            children: ['Â∞èÊòé', 'Â∞èÁ∫¢', 'Â∞èÂçé', 'Â∞è‰∏Ω']
        };

        let attendance = {
            friday: { adults: [], children: [] },
            sunday: { adults: [], children: [] }
        };

        let currentMeeting = 'friday';
        let attendanceHistory = [];

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÊòæÁ§∫ÂêØÂä®ÁîªÈù¢
            showSplashScreen();
            
            updateCurrentDate();
            loadData();
            renderAttendanceList();
            renderManageList();
            updateStats();
            setupEventListeners();
            setupPWA();
            
            // 2ÁßíÂêéÈöêËóèÂêØÂä®ÁîªÈù¢
            setTimeout(hideSplashScreen, 2000);
        });

        function showSplashScreen() {
            document.getElementById('splashScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        function hideSplashScreen() {
            document.getElementById('splashScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊòæÁ§∫ÂÆâË£ÖÊèêÁ§∫
            setTimeout(checkInstallPrompt, 1000);
        }

        function setupPWA() {
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫PWAÊ®°Âºè
            if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                // Â∑≤ÁªèÊòØPWAÊ®°ÂºèÔºå‰∏çÊòæÁ§∫ÂÆâË£ÖÊèêÁ§∫
                return;
            }
            
            // Ê≥®ÂÜåService WorkerÔºàÁî®‰∫éÁ¶ªÁ∫øÊîØÊåÅÔºâ
            if ('serviceWorker' in navigator) {
                // ÁÆÄÂçïÁöÑÂÜÖËÅîService Worker
                const swCode = `
                    self.addEventListener('install', function(e) {
                        console.log('SWÂÆâË£ÖÊàêÂäü');
                    });
                    
                    self.addEventListener('fetch', function(e) {
                        // Âü∫Êú¨ÁöÑÁºìÂ≠òÁ≠ñÁï•
                        e.respondWith(
                            caches.match(e.request).then(function(response) {
                                return response || fetch(e.request);
                            })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(function(registration) {
                        console.log('Service Worker Ê≥®ÂÜåÊàêÂäü');
                    })
                    .catch(function(error) {
                        console.log('Service Worker Ê≥®ÂÜåÂ§±Ë¥•:', error);
                    });
            }
        }

        function checkInstallPrompt() {
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÁßªÂä®ËÆæÂ§á‰∏î‰∏çÊòØPWAÊ®°Âºè
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const isStandalone = window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches;
            
            if (isMobile && !isStandalone && !localStorage.getItem('installPromptDismissed')) {
                document.getElementById('installPrompt').classList.add('show');
            }
        }

        function hideInstallPrompt() {
            document.getElementById('installPrompt').classList.remove('show');
            localStorage.setItem('installPromptDismissed', 'true');
        }

        function showInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = `Âú®iPhone/iPad‰∏äÂÆâË£ÖÊ≠§Â∫îÁî®Ôºö

1. ÁÇπÂáªSafariÊµèËßàÂô®Â∫ïÈÉ®ÁöÑÂàÜ‰∫´ÊåâÈíÆ üì§
2. Âêë‰∏ãÊªöÂä®ÊâæÂà∞"Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï" üì±
3. ÁÇπÂáª"Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï"
4. Á°ÆËÆ§Ê∑ªÂä†

ÂÆâË£ÖÂêéÔºåÂ∫îÁî®Â∞ÜÂá∫Áé∞Âú®‰∏ªÂ±èÂπï‰∏äÔºåÂ∞±ÂÉèÂéüÁîüApp‰∏ÄÊ†∑ÔºÅ`;
            } else if (isAndroid) {
                instructions = `Âú®AndroidÊâãÊú∫‰∏äÂÆâË£ÖÊ≠§Â∫îÁî®Ôºö

1. ÁÇπÂáªChromeÊµèËßàÂô®ËèúÂçï ‚ãÆ
2. ÈÄâÊã©"Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï"Êàñ"ÂÆâË£ÖÂ∫îÁî®"
3. Á°ÆËÆ§ÂÆâË£Ö

ÂÆâË£ÖÂêéÔºåÂ∫îÁî®Â∞ÜÂá∫Áé∞Âú®‰∏ªÂ±èÂπï‰∏äÔºÅ`;
            } else {
                instructions = `Âú®ÁßªÂä®ËÆæÂ§á‰∏äÔºö
- iPhone: Safari > ÂàÜ‰∫´ > Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï
- Android: Chrome > ËèúÂçï > Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï`;
            }
            
            alert(instructions);
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('zh-CN', options);
        }

        function setupEventListeners() {
            // ËÅö‰ºöÁ±ªÂûãÂàáÊç¢
            document.querySelectorAll('.meeting-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.meeting-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentMeeting = this.dataset.meeting;
                    renderAttendanceList();
                    updateStats();
                });
            });
        }

        function showSection(sectionName) {
            // Êõ¥Êñ∞Ê†áÁ≠æ
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // ÊòæÁ§∫ÂØπÂ∫îÂÜÖÂÆπ
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionName).classList.add('active');

            if (sectionName === 'stats') {
                updateStats();
                renderHistory();
            } else if (sectionName === 'manage') {
                renderManageList();
            }
        }

        function renderAttendanceList() {
            renderCategoryList('adult', 'adultList', 'adultCount');
            renderCategoryList('child', 'childList', 'childCount');
        }

        function renderCategoryList(category, listId, countId) {
            const listElement = document.getElementById(listId);
            const countElement = document.getElementById(countId);
            const memberList = category === 'adult' ? members.adults : members.children;
            const attendedList = attendance[currentMeeting][category === 'adult' ? 'adults' : 'children'];

            listElement.innerHTML = '';
            
            memberList.forEach(name => {
                const isAttended = attendedList.includes(name);
                const memberDiv = document.createElement('div');
                memberDiv.className = 'member-item';
                memberDiv.innerHTML = `
                    <input type="checkbox" class="member-checkbox" ${isAttended ? 'checked' : ''} 
                           onchange="toggleAttendance('${category}', '${name}')">
                    <span class="member-name">${name}</span>
                `;
                listElement.appendChild(memberDiv);
            });

            countElement.textContent = `${attendedList.length}/${memberList.length}`;
        }

        function toggleAttendance(category, name) {
            const categoryKey = category === 'adult' ? 'adults' : 'children';
            const attendedList = attendance[currentMeeting][categoryKey];
            
            if (attendedList.includes(name)) {
                attendance[currentMeeting][categoryKey] = attendedList.filter(n => n !== name);
            } else {
                attendedList.push(name);
            }
            
            renderAttendanceList();
            updateStats();
        }

        function renderManageList() {
            renderManageCategory('adult', 'manageAdultList');
            renderManageCategory('child', 'manageChildList');
        }

        function renderManageCategory(category, listId) {
            const listElement = document.getElementById(listId);
            const memberList = category === 'adult' ? members.adults : members.children;

            listElement.innerHTML = '';
            
            memberList.forEach((name, index) => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'member-item';
                memberDiv.innerHTML = `
                    <span class="member-name">${name}</span>
                    <div class="member-controls">
                        <button class="edit-btn" onclick="editMember('${category}', ${index})">ÁºñËæë</button>
                        <button class="delete-btn" onclick="deleteMember('${category}', ${index})">Âà†Èô§</button>
                    </div>
                `;
                listElement.appendChild(memberDiv);
            });
        }

        function addMember(category) {
            const inputId = category === 'adult' ? 'newAdultName' : 'newChildName';
            const name = document.getElementById(inputId).value.trim();
            
            if (name) {
                if (category === 'adult') {
                    members.adults.push(name);
                } else {
                    members.children.push(name);
                }
                
                document.getElementById(inputId).value = '';
                renderManageList();
                renderAttendanceList();
                saveData();
            }
        }

        function editMember(category, index) {
            const memberList = category === 'adult' ? members.adults : members.children;
            const newName = prompt('‰øÆÊîπÂßìÂêç:', memberList[index]);
            
            if (newName && newName.trim()) {
                memberList[index] = newName.trim();
                renderManageList();
                renderAttendanceList();
                saveData();
            }
        }

        function deleteMember(category, index) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊàêÂëòÂêóÔºü')) {
                if (category === 'adult') {
                    members.adults.splice(index, 1);
                } else {
                    members.children.splice(index, 1);
                }
                renderManageList();
                renderAttendanceList();
                saveData();
            }
        }

        function updateStats() {
            const currentAttendance = attendance[currentMeeting];
            const totalAttended = currentAttendance.adults.length + currentAttendance.children.length;
            const totalMembers = members.adults.length + members.children.length;
            const rate = totalMembers > 0 ? Math.round((totalAttended / totalMembers) * 100) : 0;

            document.getElementById('todayTotal').textContent = totalAttended;
            document.getElementById('todayAdults').textContent = currentAttendance.adults.length;
            document.getElementById('todayChildren').textContent = currentAttendance.children.length;
            document.getElementById('attendanceRate').textContent = rate + '%';
        }

        function saveAttendance() {
            const today = new Date().toLocaleDateString('zh-CN');
            const meetingType = currentMeeting === 'friday' ? 'Âë®‰∫îËÅö‰ºö' : 'Âë®Êó•ËÅö‰ºö';
            const currentAttendance = attendance[currentMeeting];
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Áªè‰øùÂ≠òËøá‰ªäÂ§©ÁöÑËÆ∞ÂΩï
            const existingIndex = attendanceHistory.findIndex(record => 
                record.date === today && record.meeting === meetingType
            );

            const record = {
                date: today,
                meeting: meetingType,
                adults: currentAttendance.adults.length,
                children: currentAttendance.children.length,
                total: currentAttendance.adults.length + currentAttendance.children.length,
                attendedMembers: {
                    adults: [...currentAttendance.adults],
                    children: [...currentAttendance.children]
                }
            };

            if (existingIndex >= 0) {
                attendanceHistory[existingIndex] = record;
            } else {
                attendanceHistory.unshift(record);
            }

            // Âè™‰øùÁïôÊúÄËøë30Êù°ËÆ∞ÂΩï
            if (attendanceHistory.length > 30) {
                attendanceHistory = attendanceHistory.slice(0, 30);
            }

            saveData();
            showSuccessMessage();
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            if (attendanceHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: #666;">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</div>';
                return;
            }

            attendanceHistory.forEach(record => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'history-item';
                historyDiv.innerHTML = `
                    <div class="history-date">${record.date} - ${record.meeting}</div>
                    <div class="history-stats">
                        <span>Êàê‰∫∫: ${record.adults}</span>
                        <span>ÂÑøÁ´•: ${record.children}</span>
                        <span>ÊÄªËÆ°: ${record.total}</span>
                    </div>
                `;
                historyList.appendChild(historyDiv);
            });
        }

        function showSuccessMessage() {
            const message = document.getElementById('successMessage');
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 2000);
        }

        function saveData() {
            try {
                localStorage.setItem('churchMembers', JSON.stringify(members));
                localStorage.setItem('churchAttendance', JSON.stringify(attendance));
                localStorage.setItem('churchHistory', JSON.stringify(attendanceHistory));
                console.log('Êï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®');
            } catch (error) {
                console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        function loadData() {
            try {
                const savedMembers = localStorage.getItem('churchMembers');
                const savedAttendance = localStorage.getItem('churchAttendance');
                const savedHistory = localStorage.getItem('churchHistory');
                
                if (savedMembers) {
                    members = JSON.parse(savedMembers);
                }
                
                if (savedAttendance) {
                    attendance = JSON.parse(savedAttendance);
                }
                
                if (savedHistory) {
                    attendanceHistory = JSON.parse(savedHistory);
                }
                
                console.log('Êï∞ÊçÆÂ∑≤‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩ');
            } catch (error) {
                console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
                // Â¶ÇÊûúÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ
                members = {
                    adults: ['Âº†‰∏â', 'ÊùéÂõõ', 'Áéã‰∫î', 'ËµµÂÖ≠'],
                    children: ['Â∞èÊòé', 'Â∞èÁ∫¢', 'Â∞èÂçé', 'Â∞è‰∏Ω']
                };
            }
        }
    </script>
</body>
</html>
